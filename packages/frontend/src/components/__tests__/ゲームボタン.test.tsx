/**
 * ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
 * 
 * åˆå­¦è€…å‘ã‘ãƒ¡ãƒ¢:
 * - TDD (Test-Driven Development) ã®å®Ÿè·µ
 * - ã¾ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã€å®Ÿè£…ã¯å¾Œã§è¡Œã†
 * - Testing Library ã‚’ä½¿ç”¨ã—ãŸReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
 */

import { describe, test, expect, vi } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ } from '../ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³';

describe('ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³', () => {
  test('ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    // Arrange: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
    const ãƒ†ã‚¹ãƒˆãƒ†ã‚­ã‚¹ãƒˆ = 'ã‚²ãƒ¼ãƒ é–‹å§‹';
    
    // Act: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    render(<ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³>{ãƒ†ã‚¹ãƒˆãƒ†ã‚­ã‚¹ãƒˆ}</ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³>);
    
    // Assert: æœŸå¾…ã™ã‚‹çµæœã®ç¢ºèª
    expect(screen.getByRole('button', { name: ãƒ†ã‚¹ãƒˆãƒ†ã‚­ã‚¹ãƒˆ })).toBeInTheDocument();
  });

  test('ã‚¯ãƒªãƒƒã‚¯æ™‚ã«onClickãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒå‘¼ã°ã‚Œã‚‹', async () => {
    // Arrange: ãƒ¢ãƒƒã‚¯é–¢æ•°ã®æº–å‚™
    const ã‚¯ãƒªãƒƒã‚¯å‡¦ç† = vi.fn();
    const user = userEvent.setup();
    
    // Act: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦ã‚¯ãƒªãƒƒã‚¯
    render(<ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ onClick={ã‚¯ãƒªãƒƒã‚¯å‡¦ç†}>ã‚¯ãƒªãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³>);
    const ãƒœã‚¿ãƒ³ = screen.getByRole('button', { name: 'ã‚¯ãƒªãƒƒã‚¯ãƒ†ã‚¹ãƒˆ' });
    await user.click(ãƒœã‚¿ãƒ³);
    
    // Assert: ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ãŒ1å›å‘¼ã°ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(ã‚¯ãƒªãƒƒã‚¯å‡¦ç†).toHaveBeenCalledTimes(1);
  });

  test('disabledçŠ¶æ…‹ã®æ™‚ã¯ã‚¯ãƒªãƒƒã‚¯ã§ããªã„', async () => {
    // Arrange: ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã®æº–å‚™
    const ã‚¯ãƒªãƒƒã‚¯å‡¦ç† = vi.fn();
    const user = userEvent.setup();
    
    // Act: ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    render(
      <ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ onClick={ã‚¯ãƒªãƒƒã‚¯å‡¦ç†} disabled>
        ç„¡åŠ¹ãƒœã‚¿ãƒ³
      </ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³>
    );
    const ãƒœã‚¿ãƒ³ = screen.getByRole('button', { name: 'ç„¡åŠ¹ãƒœã‚¿ãƒ³' });
    await user.click(ãƒœã‚¿ãƒ³);
    
    // Assert: ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ãŠã‚Šã€ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ãŒå‘¼ã°ã‚Œãªã„ã“ã¨ã‚’ç¢ºèª
    expect(ãƒœã‚¿ãƒ³).toBeDisabled();
    expect(ã‚¯ãƒªãƒƒã‚¯å‡¦ç†).not.toHaveBeenCalled();
  });

  test('loadingçŠ¶æ…‹ã®æ™‚ã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã•ã‚Œã‚‹', () => {
    // Arrange: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ãƒœã‚¿ãƒ³
    render(
      <ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ loading>
        èª­ã¿è¾¼ã¿ä¸­
      </ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³>
    );
    
    // Assert: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(screen.getByText('èª­ã¿è¾¼ã¿ä¸­...')).toBeInTheDocument();
  });

  test('variantãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§é©åˆ‡ãªã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œã‚‹', () => {
    // Arrange: ç•°ãªã‚‹variantã®ãƒ†ã‚¹ãƒˆ
    const { rerender } = render(<ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ variant="primary">ãƒ—ãƒ©ã‚¤ãƒãƒª</ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³>);
    
    // Assert: ãƒ—ãƒ©ã‚¤ãƒãƒªãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚¯ãƒ©ã‚¹ãŒé©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    let ãƒœã‚¿ãƒ³ = screen.getByRole('button', { name: 'ãƒ—ãƒ©ã‚¤ãƒãƒª' });
    expect(ãƒœã‚¿ãƒ³).toHaveClass('bg-game-primary');
    
    // Act: secondaryãƒœã‚¿ãƒ³ã«å¤‰æ›´
    rerender(<ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ variant="secondary">ã‚»ã‚«ãƒ³ãƒ€ãƒª</ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³>);
    
    // Assert: ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    ãƒœã‚¿ãƒ³ = screen.getByRole('button', { name: 'ã‚»ã‚«ãƒ³ãƒ€ãƒª' });
    expect(ãƒœã‚¿ãƒ³).toHaveClass('bg-secondary');
  });

  test('sizeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§é©åˆ‡ãªã‚µã‚¤ã‚ºãŒé©ç”¨ã•ã‚Œã‚‹', () => {
    // Arrange: ç•°ãªã‚‹ã‚µã‚¤ã‚ºã®ãƒ†ã‚¹ãƒˆ
    render(<ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ size="lg">å¤§ãã„ãƒœã‚¿ãƒ³</ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³>);
    
    // Assert: å¤§ãã„ã‚µã‚¤ã‚ºã®ã‚¯ãƒ©ã‚¹ãŒé©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    const ãƒœã‚¿ãƒ³ = screen.getByRole('button', { name: 'å¤§ãã„ãƒœã‚¿ãƒ³' });
    expect(ãƒœã‚¿ãƒ³).toHaveClass('h-11', 'px-8');
  });

  test('ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼ˆEnterã‚­ãƒ¼ï¼‰', async () => {
    // Arrange: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®ãƒ†ã‚¹ãƒˆæº–å‚™
    const ã‚¯ãƒªãƒƒã‚¯å‡¦ç† = vi.fn();
    const user = userEvent.setup();
    
    // Act: ãƒœã‚¿ãƒ³ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¦Enterã‚­ãƒ¼ã‚’æŠ¼ã™
    render(<ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ onClick={ã‚¯ãƒªãƒƒã‚¯å‡¦ç†}>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ</ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³>);
    const ãƒœã‚¿ãƒ³ = screen.getByRole('button', { name: 'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ' });
    ãƒœã‚¿ãƒ³.focus();
    await user.keyboard('{Enter}');
    
    // Assert: Enterã‚­ãƒ¼ã§ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ãŒå‘¼ã°ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(ã‚¯ãƒªãƒƒã‚¯å‡¦ç†).toHaveBeenCalledTimes(1);
  });

  test('ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£: aria-label ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã‚‹', () => {
    // Arrange: ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
    render(
      <ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ aria-label="ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³">
        ğŸ®
      </ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³>
    );
    
    // Assert: aria-labelãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    const ãƒœã‚¿ãƒ³ = screen.getByRole('button', { name: 'ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³' });
    expect(ãƒœã‚¿ãƒ³).toHaveAttribute('aria-label', 'ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³');
  });
});